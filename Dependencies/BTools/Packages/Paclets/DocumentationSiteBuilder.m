(* ::Package:: *)

(* Autogenerated Package *)

DocumentationSiteBuild::usage=
	"Builds the documentation site";
DocumentationSiteDeploy::usage=
	"Deploys the documentation site";


Begin["`Private`"];


(* ::Subsection:: *)
(*DocumentationSite*)



$DocSiteDirectory:=
	$DocSiteDirectory=
		FileNameJoin@{
			$WebSiteDirectory,
			"DocumentationSite"
			};


Clear@DocSiteInitializedQ;
DocSiteInitializedQ[dir_String?DirectoryQ]:=
	AllTrue[{dir,FileNameJoin@{dir,"content"},FileNameJoin@{dir,"SiteConfig.wl"}},
		FileExistsQ
		];
DocSiteInitializedQ[___]:=False


$DocSiteInitialized:=
	DocSiteInitializedQ[$DocSiteDirectory];


possibleDocSiteQ=(DirectoryQ[#]||DirectoryQ[DirectoryName[#]]&);


DocumentationSiteInitialize//Clear
DocumentationSiteInitialize[
	dir:_String?possibleDocSiteQ|Automatic:Automatic
	]:=
	With[{d=Replace[dir, Automatic:>$DocSiteDirectory]},
		If[!DocSiteInitializedQ[d],	
			If[!DirectoryQ@d,	
				CreateDirectory[d,CreateIntermediateDirectories->True]
				]
			];
			With[
				{
					tempDir=
						PackageFilePath["Resources", "Templates", "SiteBuilder", "DocumentationSite"]
					},
				Map[
					With[{
						tf=FileNameJoin@{d,FileNameDrop[#,FileNameDepth[tempDir]]}
						},
						If[!FileExistsQ@tf,
							If[DirectoryQ@#,
								CopyDirectory[#,tf],
								CopyFile[#,tf]
								]
							]
						]&,
					FileNames["*",tempDir]
					];
				]
			]


DocumentationSiteBuild//Clear


Options[DocumentationSiteBuild]=
	Join[
		{
			"BuildOverview"->False
			},
		Options[WebSiteBuild]
		];
DocumentationSiteBuild[
	dir:_String?possibleDocSiteQ|Automatic:Automatic,
	ops:OptionsPattern[]
	]:=
	With[{d=Replace[dir, Automatic:>$DocSiteDirectory]},
		With[{buildOverview=TrueQ@OptionValue["BuildOverview"]},
			DocumentationSiteInitialize[d];
			If[buildOverview,
				DocGen[
					"HTML",
					Evaluate@DocGen[
						"MultiPackageOverview",
						Evaluate@$DocGenDirectory,
						Method->"Save"
						],
					CloudDeploy->True
					]
				];
			WebSiteBuild[d,
				Sequence@@FilterRules[{ops},Options[WebSiteBuild]]
				]
			]
		];


DocumentationSiteDeploy//Clear
Options[DocumentationSiteDeploy]=
	Options[WebSiteDeploy];
DocumentationSiteDeploy[
	dir:_String?possibleDocSiteQ|Automatic:Automatic,
	ops:OptionsPattern[]
	]:=
	With[{d=Replace[dir, Automatic:>$DocSiteDirectory]},
		WebSiteDeploy[
			d,
			"/",
			Sequence@@
				FilterRules[{ops},Options[WebSiteDeploy]]
			]
		]


End[];



